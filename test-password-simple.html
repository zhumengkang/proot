<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>密码系统测试</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .code { background-color: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>密码系统测试</h1>
    
    <div id="results"></div>
    
    <button onclick="runTests()">运行测试</button>
    
    <!-- 引入脚本 -->
    <script src="config/master-config.js"></script>
    <script src="js/auth-config.js"></script>
    <script src="js/password.js"></script>

    <script>
        async function runTests() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="info">开始测试...</div>';
            
            const tests = [];
            
            // 测试1: 检查主配置
            try {
                if (window.MASTER_CONFIG) {
                    tests.push(`✅ 主配置已加载: ${JSON.stringify(window.MASTER_CONFIG.auth, null, 2)}`);
                } else {
                    tests.push('❌ 主配置未加载');
                }
            } catch (error) {
                tests.push(`❌ 主配置检查失败: ${error.message}`);
            }
            
            // 测试2: 检查AUTH_CONFIG
            try {
                if (window.AUTH_CONFIG) {
                    tests.push(`✅ AUTH_CONFIG已加载: password=${window.AUTH_CONFIG.password}, enabled=${window.AUTH_CONFIG.enabled}`);
                } else {
                    tests.push('❌ AUTH_CONFIG未加载');
                }
            } catch (error) {
                tests.push(`❌ AUTH_CONFIG检查失败: ${error.message}`);
            }
            
            // 测试3: 检查isPasswordProtected
            try {
                const isProtected = window.isPasswordProtected ? window.isPasswordProtected() : 'undefined';
                tests.push(`${isProtected ? '✅' : '❌'} isPasswordProtected: ${isProtected}`);
            } catch (error) {
                tests.push(`❌ isPasswordProtected检查失败: ${error.message}`);
            }
            
            // 测试4: 检查isPasswordRequired
            try {
                const isRequired = window.isPasswordRequired ? window.isPasswordRequired() : 'undefined';
                tests.push(`${!isRequired ? '✅' : '❌'} isPasswordRequired: ${isRequired}`);
            } catch (error) {
                tests.push(`❌ isPasswordRequired检查失败: ${error.message}`);
            }
            
            // 测试5: 检查getPasswordHash
            try {
                if (typeof window.getPasswordHash === 'function') {
                    const hash = await window.getPasswordHash();
                    tests.push(`${hash ? '✅' : '❌'} getPasswordHash: ${hash}`);
                } else {
                    tests.push('❌ getPasswordHash函数不存在');
                }
            } catch (error) {
                tests.push(`❌ getPasswordHash检查失败: ${error.message}`);
            }
            
            // 测试6: 验证密码
            try {
                if (typeof window.verifyPassword === 'function') {
                    const isValid = await window.verifyPassword('123qwe!@#QWE');
                    tests.push(`${isValid ? '✅' : '❌'} 密码验证 "123qwe!@#QWE": ${isValid}`);
                } else {
                    tests.push('❌ verifyPassword函数不存在');
                }
            } catch (error) {
                tests.push(`❌ 密码验证失败: ${error.message}`);
            }
            
            results.innerHTML = `
                <div class="test-result ${tests.some(t => t.includes('❌')) ? 'error' : 'success'}">
                    <h3>测试结果</h3>
                    <div class="code">${tests.join('\n')}</div>
                </div>
            `;
        }
        
        // 页面加载后自动运行测试
        setTimeout(runTests, 1000);
    </script>
</body>
</html>